# NPM Crash course

Видео на английском — [https://www.youtube.com/watch?v=jHDhaSSKmB0](https://www.youtube.com/watch?v=jHDhaSSKmB0)

## Что такое NPM?

* NPM — Node Package Manager
* Предустановлен с Node.js
* Легко устанавливает модули/пакеты на вашу систему/в проект
* Модулями обычно являются JavaScript библиотеки
* Облегчает распространение и повторное использование кода для разработчиков

Опыт использования NodeJS не обязателен.
Пригоден для установки любых зависимостей, как фронтенд так и бекенд.

## Что мы узнаем?

* Установка, удаление, обновление и просмотр пакетов
* Все о файле package.json
* Dependencies/dev-dependencies
* Версионирование
* Команды и ярлыки
* npm scripts

## Начнем…

Чтобы использовать npm нужен NodeJS, если у вас его ещё нет,  идем по ссылке [https://nodejs.org/en/](https://nodejs.org/en/) и устанавливаем текущую версию
[https://www.npmjs.com/](https://www.npmjs.com/) репозиторий пакетов NPM где можно найти все что нужно.

Создадим новую директорию, с названием `npm-app`. Мы сейчас не будем фокусироваться на самом приложении, сейчас мы хотим разобраться как пользоваться npm. Открываем папку в VS Code.

проверить версию
`npm -v`
`npm --version` — длинная версия команды

Если набрать `npm` мы увидим короткую документацию по npm, `npm help` даст нам такой-же вывод

Мы не будем рассматривать все из них многие из этих команд нужны чтобы опубликовать ваш пакет в репозитории пакетов

## Package.json File

* Файл-манифест с информацией о вашем приложении
* Списки зависимостей (имя и версия)
* Указывает должна ли быть версия зависимости обновлена
* Создание npm-скриптов
* Легко создается командой `npm init`

[https://docs.npmjs.com/getting-started/using-a-package.json](https://docs.npmjs.com/getting-started/using-a-package.json)

Файл-манифест содержит информацию о вашем приложении, такую как название приложение, автор, версия, но это не самое главное здесь.
Самое важное что этот файл содержит информацию о зависимостях вашего приложения. Например если наш проект зависит от `gulp`, он будет указан в package.json, и кроме названий зависимостей, здесь указывается также какая версия пакета используется, чтобы избежать несовместимостей с новыми версиями зависимостей.

Этот файл можно создать вручную, но это пустая трата времени, так как есть команда `npm init`

Попробуем ввести в терминале `npm init` и попадаем в мастер где указываем

* Имя приложения
* Версию (как делать [семантическое версионирование](https://semver.org/lang/ru/) рассмотрим позже)
* Описание приложения
* Точка входа entry point,
* и т. д.

Короткая форма `npm init -y` отвечает на все вопросы *Да* и сразу создаёт файл `package.json`

Чтобы изменить значения по-умолчанию, можно использовать команды `npm set` или `npm config set` и далее ключи которые мы хотим получить типа `author` `licence` и т. д.

[npm-config](https://docs.npmjs.com/cli/config "npm-config документация")

Чтобы получить данные о настройках по умолчанию набираем
`npm get` или `npm config get`

Чтобы удалить поля, нужно выполнить команду `npm config delete #{key}`
И если мы удалим наш `package.json` и сделаем заново `npm init -y` там будут уже новые значения по-умолчанию.

Таким образом мы можем устанавливать, изменять и удалять значения по-умолчанию.

## Установка расширений

Теперь попробуем установить расширение, например lodash, для этого наберем `npm install lodash --save`, флаг `--save` сохраняет запись об этой зависимости в файле package.json. Если мы не используем этот флаг, то npm установит зависимость, будет создана директория `node_modules`, но зависимость не будет сохранена в `package.json`

После выполнения команды `npm install lodash --save` произойдет две вещи:

* будет создана папка `node_modules` и в неё помещена папка зависимости, в нашем случае lodash
* в файл `package.json` будет добавлена запись о зависимости и ёё версии (чуть позже разберемся с версиями)

Теперь создадим файл `index.js` и используем в нём lodash. И убедимся что оно работает. Суть приложения сейчас не существенна, главное что сработала зависимость.

### Зачем сохранять зависимость с флагом `--save`

Когда мы готовы сохранить наше приложение в репозиторий системы контроля версий, чтобы другие люди могли использовать наше приложение. Зависимости которые мы используем в нашем приложении, нет смысла хранить в репозтории, так как это код третьих поставщиков (3rd party), мы просто можем их взять из репозиториeв модулей. Мы не хотим помещать код модулей в наш репозиторий, по этому мы добавляем `node_modules` в `.gitignore`.
Допустим кто-то взял код нашего приложения (как в паре последних примеров, с github), склонировал его. Открываем папку этого приложения в терминале, пытаемся запустить как есть, но мы получим ошибку, так как наши зависимости ещё не установлены после клонирования из репозитория. Теперь нам нужно выполнить команду `npm install` после чего npm узнает, какие нужны зависимости из `package.json` и установит их.  Теперь снова запустить `node index` и всё работает.
Попробуем сделать то же самое, удалим `node_modules` и удалим раздел `dependencies` из `package.json` и мы увидим что снова скрипт не сработает, по очевидной причине. По этому важно сохранять зависимости в `package.json`.

### Зависимости разработчика

Такие зависимости нужны для процесса разработки, но не для конечного приложения. Например это может быть gulp.
Попробуем установить такое расширение, `npm install --save-dev gulp gulp-sass`, также здесь видно что можно устанавливать сразу несколько зависимостей.
Зависимости разработчика размещаются в `package.json` в разделе `devDependencies`
В папке `node_modules` появилось много файлов, которые мы явно не устанавливали сами. Причина этого в том, что сам gulp имеет очень много зависимостей, и тянет их из репозитория при установке. Это очень сильно может раздуть `node_modules`, по этой причине мы не хотим хранить эту папку в репозитории системы контроля версий.
![Шутка на тему веса node\_modules](/articles/2018.11.04-instruments/DraggedImage.png "Самые тяжелые объекты вселенной")

И так как на продакшн нам не нужны зависимости разработчика, мы можем установить только зависимости приложения выполнив команду `npm install --production`, в результате в `node_modules` не будет зависимостей разработки. Если мы просто запустим `npm install`, то будут установлены все зависимости.

## Удаление зависимостей

Например, мы не хотим более использовать `gulp-sass`, выполним `npm uninstall gulp-sass --save-dev` и увидим что этот пакет удален из `node_modules` и из `package.json`
Синонимы:

* `npm remove`
* `npm rm`
* `npm un`

## Установка конкретных версий пакетов

Удалим для начала зависимость `lodash` — `npm rm lodash --save`.
Допустим, нам нужно установить более раннюю версию этого пакета, например, если сейчас последня версия это **4.17.4**, а нам нужно установить **4.17.3**. Для этого мы должны выполнить  `npm install lodash@4.17.3 --save`

## Семантическое версионирование

[https://docs.npmjs.com/all#how-to-use-semantic-versioning](https://docs.npmjs.com/all#how-to-use-semantic-versioning)
Группа из трех реже из четырех цифр разделенных точкой:

* **Патч** — исправляет ошибки, не ломает совместимость
* **Минорная версия** — добавляет новую функциональность, но не ломает обратную совместимость
* **Мажорная версия** — ломает обратную совместимость, нужно переписывать приложение

![Семантическое версионирование](/articles/2018.11.04-instruments/DraggedImage-1.png)


При этом всегда проверяйте новые версии на совместимость. Бывают ситуации когда минорные обновления ломают обратную совместимость или вносят критические баги.

### Символы для указания версионирования

* `^` — минорная версия
* `~` — сохраняет минорную версию, обновляет только патчи
* Если не указывать символы, `npm` не будет устанавливать обновления, зависимость останется на текущей версии
* `*` — будет устанавливать все версии зависимости (это рискованно так как приложение может поломаться из-за обратной несовместимости)

## Глобальные пакеты

Пакеты которые можно использовать везде в терминале, не привязываясь к проекту.
Например мы хотим глобально установить пакет `nodemon` [https://nodemon.io/](https://nodemon.io/), который будет наблюдать за изменениями в приложении NodeJS и будет перезапускать его при изменениях.
Выполняем `npm install -g nodemon`
Этот пакет не появится в нашем текущем проекте, так как он устанавливается глобально, на весь компьютер.
`npm root -g` — показывает где хранятся глобальные модули

### Удаление глобальных пакетов

`npm uninstall -g nodemon`

## Список проектов

`npm list` — показывает список всех пакетов, на всех уровнях
`npm list -g` — список глобальных пакетов
Чтобы получить список зависимостей только верхнего уровня, нужно добавить флаг глубины `--depth=0` — цифра указывает уровень вложенности зависимостей.

## Скрипты

В `package.json` свойство `"scripts"`
По умолчанию там есть `"test"` для тестирования, тесты нужно писать самостоятельно.
Часто можно увидеть скрипт `"start": "node index.js"` или другое значение файла скрипта.
Чтобы запустить скрипт нужно в консоли набрать `npm run start` где _start_ — имя скрипта
[https://docs.npmjs.com/cli/run-script](https://docs.npmjs.com/cli/run-script)
Некоторые скрипты не требуют указания run, их можно запустить `npm start`

# Gulp
[https://gulpjs.com/](https://gulpjs.com/)

Видео на английском — [https://www.youtube.com/watch?v=1rw9MfIleEg](https://www.youtube.com/watch?v=1rw9MfIleEg)

## Что такое Gulp?

* Набор инструментов с открытым исходным кодом и таск раннер
* Система сборки фронт-енда
* Работает на Node.js и npm
* Используется для автоматизации длительных и повторяющихся задач
* Доступны сотни плагинов для различных задач

## Повторяющиеся задачи

* Минификация скриптов и стилей
* Конкатенация
* Очистка кеша
* Тестирование, проверка на стилистические ошибки, оптимизация
* Серверы для разработки

## Как работает gulp

* Построен на node streams
 [https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D1%82%D0%BE%D0%BA\_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85](https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D1%82%D0%BE%D0%BA_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)
 [https://habrahabr.ru/company/zerotech/blog/339900/](https://habrahabr.ru/company/zerotech/blog/339900/)
* Пайплайны / `.pipe()` оператор — цепочки преобразований потока данных, где вывод одного элемента попадает на следующего элемента
* Плагины выполняют одну единственную задачу, задачи можно объединять в цепочки
* Файлы не записываются пока все плагины цепочки не отработают

![Gulp workflow](/articles/2018.11.04-instruments/gulp-workflow.png)

## Практика

Открываем терминал и устанавливаем gulp глобально
`npm install gulp -g`

Создаем директорию для проекта `mkdir gulpdemo` и переходим в нее `cd gulpdemo` и открываем там редактор `code .`

`npm init --y`
`npm install --save-dev gulp`

``` js
const gulp = require('gulp');
const imagemin = require('gulp-imagemin');
const uglify = require('gulp-uglify');
const sass = require('gulp-sass');
const concat = require('gulp-concat');
```

## Browsersync

[https://browsersync.io/docs/gulp](https://browsersync.io/docs/gulp)

## Sourcemaps

[https://www.npmjs.com/package/gulp-sourcemaps](https://www.npmjs.com/package/gulp-sourcemaps)

## Код нашего проекта на Github

[https://github.com/curtdp/gulpdemo](https://github.com/curtdp/gulpdemo)

# Git

Видео на английском — [https://www.youtube.com/watch?v=SWYqp7iY\_Tc](https://www.youtube.com/watch?v=SWYqp7iY_Tc)
[Система контроля версий](https://git-scm.com/book/ru/v2/%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%9E-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B5-%D0%BA%D0%BE%D0%BD%D1%82%D1%80%D0%BE%D0%BB%D1%8F-%D0%B2%D0%B5%D1%80%D1%81%D0%B8%D0%B9 "О системе контроля версий")
Может быть сложной в изучении, но даже знание основ, позволит сделать уже достаточно много для разработки.

## Базовые команды

``` bash
git init
git add
git commit
git push
git pull
git branch
```

## Визуальные клиенты

* [https://www.sourcetreeapp.com/](https://www.sourcetreeapp.com/)
* [https://desktop.github.com/](https://desktop.github.com/)
